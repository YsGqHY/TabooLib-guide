"use strict";(self.webpackChunktaboolib_guide=self.webpackChunktaboolib_guide||[]).push([["547"],{3264:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>l,toc:()=>d,default:()=>h,metadata:()=>r,assets:()=>s,contentTitle:()=>a});var r=JSON.parse('{"id":"adyeshach/start/dev/entity/controller","title":"\u63A7\u5236\u5668","description":"\u672C\u6587\u53EA\u4ECB\u7ECD\u63A7\u5236\u5668 API \u7684\u4F7F\u7528\u65B9\u5F0F\uFF0C\u5BF9\u4E8E\u63A7\u5236\u5668\u7684\u8BE6\u7EC6\u8BF4\u660E\uFF0C\u8BF7\u53C2\u8003 \u6280\u672F\u6587\u6863 \u4E2D\u7684\u63A7\u5236\u5668\u90E8\u5206\u3002","source":"@site/docs/adyeshach/start/dev/entity/controller.md","sourceDirName":"adyeshach/start/dev/entity","slug":"/adyeshach/start/dev/entity/controller","permalink":"/adyeshach/start/dev/entity/controller","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"\u7BA1\u7406\u5668","permalink":"/adyeshach/start/dev/entity/manager"},"next":{"title":"\u4E8B\u4EF6\u7CFB\u7EDF","permalink":"/adyeshach/start/dev/event"}}'),o=t(9979),i=t(6774);let l={sidebar_position:2},a="\u63A7\u5236\u5668",s={},d=[{value:"\u5B9E\u73B0",id:"\u5B9E\u73B0",level:2},{value:"\u6CE8\u518C",id:"\u6CE8\u518C",level:2},{value:"\u53C2\u6570 &amp; \u6301\u4E45\u5316",id:"\u53C2\u6570--\u6301\u4E45\u5316",level:2},{value:"\u81EA\u5B9A\u4E49\u5E8F\u5217\u5316",id:"\u81EA\u5B9A\u4E49\u5E8F\u5217\u5316",level:3}];function c(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"\u63A7\u5236\u5668",children:"\u63A7\u5236\u5668"})}),"\n",(0,o.jsxs)(e.p,{children:["\u672C\u6587\u53EA\u4ECB\u7ECD\u63A7\u5236\u5668 API \u7684\u4F7F\u7528\u65B9\u5F0F\uFF0C\u5BF9\u4E8E\u63A7\u5236\u5668\u7684\u8BE6\u7EC6\u8BF4\u660E\uFF0C\u8BF7\u53C2\u8003 ",(0,o.jsx)(e.strong,{children:"\u6280\u672F\u6587\u6863"})," \u4E2D\u7684",(0,o.jsx)(e.a,{href:"/plugin/adyeshach/start/tech/controller",children:"\u63A7\u5236\u5668"}),"\u90E8\u5206\u3002"]}),"\n",(0,o.jsx)(e.h2,{id:"\u5B9E\u73B0",children:"\u5B9E\u73B0"}),"\n",(0,o.jsxs)(e.p,{children:["\u4EE5 ",(0,o.jsx)(e.strong,{children:"\u968F\u4FBF\u8D70\u8D70"})," \u4E3A\u4F8B\uFF0C\u4E0B\u6587\u5C06\u6F14\u793A\u5982\u4F55\u5B9E\u73B0\u4E00\u4E2A\u7B80\u5355\u7684\u63A7\u5236\u5668\uFF1A"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-kotlin",children:'import ink.ptms.adyeshach.core.entity.EntityInstance\nimport ink.ptms.adyeshach.core.entity.controller.Controller\nimport ink.ptms.adyeshach.core.entity.path.PathFinderHandler\nimport ink.ptms.adyeshach.core.entity.path.Request\nimport ink.ptms.adyeshach.core.entity.path.ResultRandomPosition\n\nclass ControllerRandomStrollLand(entity: EntityInstance) : Controller(entity) {\n\n    override fun id(): String {\n        return "RANDOM_STROLL_LAND"\n    }\n\n    override fun group(): String {\n        return "WALK"\n    }\n\n    override fun shouldExecute(): Boolean {\n        // \u5F53\u6EE1\u8DB3\u6982\u7387\u65F6\u89E6\u53D1\u63A7\u5236\u5668\n        return entity != null && entity!!.random().nextDouble() < 0.001;\n    }\n\n    override fun continueExecute(): Boolean {\n        // \u4E0D\u4F1A\u7EE7\u7EED\u6267\u884C\n        return false\n    }\n\n    override fun start() {\n        if (entity != null) {\n            // \u8BF7\u6C42\u4E00\u4E2A\u968F\u673A\u4F4D\u7F6E\n            PathFinderHandler.request(entity!!.getLocation(), request = Request.RANDOM_POSITION) {\n                // \u79FB\u52A8\u5230\u968F\u673A\u4F4D\u7F6E\n                entity!!.controllerMoveTo((it as ResultRandomPosition).random.toLocation(entity!!.world))\n            }\n        }\n    }\n}\n'})}),"\n",(0,o.jsx)(e.p,{children:"\u5728\u8FD9\u4E4B\u540E\uFF0C\u6211\u4EEC\u4FBF\u53EF\u4EE5\u76F4\u63A5\u5C06\u8BE5\u63A7\u5236\u5668\u6DFB\u52A0\u5230\u5355\u4F4D\u8EAB\u4E0A\uFF1A"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-kotlin",children:"entity.registerController(ControllerRandomStrollLand(entity))\n"})}),"\n",(0,o.jsx)(e.p,{children:"\u6216\u662F\u79FB\u9664\uFF1A"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-kotlin",children:'// \u4F7F\u7528\u5E8F\u53F7\u79FB\u9664\nentity.unregisterController("RANDOM_STROLL_LAND")\n'})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-kotlin",children:"// \u4F7F\u7528\u7C7B\u79FB\u9664\nentity.unregisterController(ControllerRandomStrollLand::class.java)\n"})}),"\n",(0,o.jsxs)(e.p,{children:["\u5C3D\u7BA1\u6B64\u65F6\u8FD9\u4E2A\u63A7\u5236\u5668\u5DF2\u7ECF\u53EF\u4EE5\u4F7F\u7528\uFF0C\u4F46\u662F\u5B83\u8FD8\u4E0D\u80FD\u501F\u52A9 ",(0,o.jsx)(e.code,{children:"\u811A\u672C"})," \u6216\u662F ",(0,o.jsx)(e.code,{children:"\u7F16\u8F91\u9875\u9762"})," \u6765\u6DFB\u52A0\u5230\u5355\u4F4D\u8EAB\u4E0A\u3002"]}),"\n",(0,o.jsx)(e.h2,{id:"\u6CE8\u518C",children:"\u6CE8\u518C"}),"\n",(0,o.jsxs)(e.p,{children:["\u60F3\u8981\u4F7F\u63A7\u5236\u5668\u53EF\u4EE5\u88AB ",(0,o.jsx)(e.code,{children:"\u811A\u672C"})," \u6216 ",(0,o.jsx)(e.code,{children:"\u7F16\u8F91\u9875\u9762"})," \u8BBF\u95EE\uFF0C\u8FD8\u9700\u8981\u501F\u52A9\u63A7\u5236\u5668\u6CE8\u518C\u63A5\u53E3\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-kotlin",children:'// \u83B7\u53D6\u63A7\u5236\u5668\u6CE8\u518C\u63A5\u53E3\nval registry = Adyeshach.api().getEntityControllerRegistry()\n// \u521B\u5EFA\u63A7\u5236\u5668\u751F\u6210\u5668\nval generator = ControllerGenerator(ControllerRandomStrollLand::class.java) { ControllerRandomStrollLand(it) }\n// \u6CE8\u518C\u63A7\u5236\u5668\nregistry.registerControllerGenerator("RANDOM_STROLL_LAND", generator)\n'})}),"\n",(0,o.jsxs)(e.p,{children:["\u6B64\u65F6\u8FD9\u4E2A\u63A7\u5236\u5668\u5C31\u53EF\u4EE5\u88AB ",(0,o.jsx)(e.code,{children:"\u811A\u672C"})," \u6216 ",(0,o.jsx)(e.code,{children:"\u7F16\u8F91\u9875\u9762"})," \u8BBF\u95EE\u4E86\uFF0C\u4F46\u5B83\u8FD8\u4E0D\u591F\u5B8C\u5584\u3002"]}),"\n",(0,o.jsx)(e.h2,{id:"\u53C2\u6570--\u6301\u4E45\u5316",children:"\u53C2\u6570 & \u6301\u4E45\u5316"}),"\n",(0,o.jsxs)(e.p,{children:["\u5BF9\u4E8E\u9700\u8981\u4F7F\u7528\u989D\u5916\u53C2\u6570\u7684\u63A7\u5236\u5668\uFF0C\u5C31\u6CA1\u6709\u90A3\u4E48\u7B80\u5355\u4E86\u3002\u73B0\u5728\uFF0C\u6211\u4EEC\u8981\u4E3A\u4E0A\u9762\u7684\u6F14\u793A\u63A7\u5236\u5668\u6DFB\u52A0\u4E00\u4E2A\u53C2\u6570\uFF1A",(0,o.jsx)(e.code,{children:"probability"}),"\uFF0C\u8868\u793A\u6267\u884C\u6982\u7387\u3002"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-kotlin",children:'...\nimport com.google.gson.annotations.Expose\n\nclass ControllerRandomStrollLand(entity: EntityInstance, @Expose val probability: Double) : Controller(entity) {\n\n    constructor(entity: EntityInstance) : this(entity, 0.01)\n\n    ...\n\n    override fun shouldExecute(): Boolean {\n        // \u5F53\u6EE1\u8DB3\u6982\u7387\u65F6\u89E6\u53D1\u63A7\u5236\u5668\n        return entity != null && entity!!.random().nextDouble() < probability;\n    }\n    \n    ...\n    \n    override fun toString(): String {\n        return "${id()}:${"%.2f".format(probability)}"\n    }\n}    \n'})}),"\n",(0,o.jsxs)(e.p,{children:["\u540C\u65F6\uFF0C\u8FD9\u4E2A\u53C2\u6570\u9700\u8981\u88AB\u6301\u4E45\u5316\uFF0C\u5426\u5219\u4F1A\u5728\u91CD\u8F7D\u65F6\u4E22\u5931\u3002\u6211\u4EEC\u9700\u8981\u4E3A\u5176\u6DFB\u52A0\u4E00\u4E2A ",(0,o.jsx)(e.code,{children:"@Expose"})," \u6CE8\u89E3\u3002\u5E76\u4E14\uFF0C\u6211\u4EEC\u8FD8\u8981\u4FEE\u6539\u5B83\u7684 ",(0,o.jsx)(e.code,{children:"toString"})," \u65B9\u6CD5\uFF0C\u4F7F\u5176\u80FD\u591F\u88AB ",(0,o.jsx)(e.code,{children:"\u7F16\u8F91\u9875\u9762"})," \u5728\u76F8\u540C\u63A7\u5236\u5668\u7684\u4E0D\u540C\u53C2\u6570\u4E2D\u9274\u522B\u3002"]}),"\n",(0,o.jsxs)(e.p,{children:["\u4E24\u4E2A\u53CA\u4EE5\u4E0A\u7684\u53C2\u6570\u4E4B\u95F4\u4F7F\u7528 ",(0,o.jsx)(e.code,{children:","})," \u8FDB\u884C\u5206\u5272\uFF0C\u4F8B\u5982\uFF1A",(0,o.jsx)(e.code,{children:"RANDOM_STROLL_LAND:0.01,0.5"}),"\u3002"]}),"\n",(0,o.jsx)(e.admonition,{type:"caution",children:(0,o.jsxs)(e.p,{children:["\u5BF9\u4E8E\u6D6E\u70B9\u6570\u5FC5\u987B\u4FDD\u7559\u4E24\u4F4D\u5C0F\u6570\uFF0C\u5426\u5219\u4F1A\u56E0\u7CBE\u5EA6\u4E22\u5931\u5BFC\u81F4 ",(0,o.jsx)(e.code,{children:"\u7F16\u8F91\u9875\u9762"})," \u65E0\u6CD5\u6B63\u5E38\u8BC6\u522B\u3002"]})}),"\n",(0,o.jsx)(e.h3,{id:"\u81EA\u5B9A\u4E49\u5E8F\u5217\u5316",children:"\u81EA\u5B9A\u4E49\u5E8F\u5217\u5316"}),"\n",(0,o.jsx)(e.p,{children:"\u5BF9\u4E8E\u7279\u6B8A\u7684\u9700\u6C42\uFF0CAdyeshach \u652F\u6301\u63A7\u5236\u5668\u7684\u81EA\u5B9A\u4E49\u5E8F\u5217\u5316\u65B9\u5F0F\u3002"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-kotlin",children:'...\n\nclass ControllerRandomStrollLand(entity: EntityInstance, val probability: Double) : Controller(entity), CustomSerializable {\n\n    ...\n    \n    override fun serialize(): JsonObject {\n        return JsonObject().also { it.addProperty("probability", probability) }\n    }\n    \n    companion object {\n    \n        @JvmStatic\n        fun deserialize(data: JsonObject): ControllerGenerator {\n            val probability = data["probability"].asDouble\n            return ControllerGenerator(ControllerRandomStrollLand::class.java) { ControllerRandomStrollLand(it, probability) }\n        }\n    }\n}    \n'})}),"\n",(0,o.jsxs)(e.p,{children:["\u4F7F\u7528\u81EA\u5B9A\u4E49\u5E8F\u5217\u5316\u7684\u63A7\u5236\u5668\uFF0C\u5FC5\u987B\u5728\u7C7B\u4E2D\u58F0\u660E\u4E00\u4E2A\u9759\u6001\u65B9\u6CD5 ",(0,o.jsx)(e.code,{children:"deserialize"}),"\u3002"]})]})}function h(n={}){let{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(c,{...n})}):c(n)}},6774:function(n,e,t){t.d(e,{Z:()=>a,a:()=>l});var r=t(2136);let o={},i=r.createContext(o);function l(n){let e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:l(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);